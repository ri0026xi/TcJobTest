# 製造現場向け複雑ジョブシーケンス実装ガイド

## 概要

TwinCAT3 PLCジョブフレームワークを活用した製造現場向けの複雑なピック&プレース自動化ステーションの実装例です。

## システム構成

### 入力スイッチ（6個）
1. **START_SWITCH** - 開始スイッチ
2. **STOP_SWITCH** - 停止スイッチ  
3. **RESET_SWITCH** - リセットスイッチ
4. **PART_PRESENT_SENSOR** - 部品検知センサー
5. **GRIPPER_CLOSED_SENSOR** - グリッパー閉状態センサー
6. **GRIPPER_OPEN_SENSOR** - グリッパー開状態センサー

### 状態ランプ（4個）
1. **READY_LAMP** - 準備完了ランプ（緑色）
2. **RUNNING_LAMP** - 動作中ランプ（青色点滅）
3. **ERROR_LAMP** - エラーランプ（赤色点滅）
4. **COMPLETED_LAMP** - 完了ランプ（緑色）

### 軸構成（3軸）
- **X軸** - 水平移動軸
- **Y軸** - 水平移動軸
- **Z軸** - 垂直移動軸

## 実装されたコンポーネント

### 1. カスタムFutureクラス

#### `FutureGripperControl`
- グリッパーの開閉制御を行うFuture
- タイムアウト機能付き
- センサーフィードバックによる動作確認

#### `FutureStatusLampControl`
- 作業者向け状態ランプの制御
- 点灯・点滅パターンの管理
- 状態に応じた自動切り替え

### 2. データ構造

#### `ST_ManufacturingSystemIO`
- システム全体のI/O定義
- 位置データとモーション制御パラメータ
- 設定可能な動作パラメータ

### 3. メイン制御クラス

#### `ManufacturingSequenceController`
- 製造シーケンス全体の統合制御
- 状態機械による制御フロー管理
- エラーハンドリング機能

## 動作シーケンス

1. **初期化** - 全軸をホーム位置に移動
2. **準備完了** - 部品検知待ち状態
3. **ピック動作**
   - ピック位置へ移動（X、Y軸）
   - Z軸下降
   - グリッパー閉
   - Z軸上昇
4. **プレース動作**
   - プレース位置へ移動（X、Y軸）
   - Z軸下降
   - グリッパー開
   - Z軸上昇
5. **復帰** - ホーム位置復帰
6. **完了** - 完了信号とランプ表示

## 使用方法

### 基本的な使用手順

1. **MANUFACTURING_EXAMPLE**プログラムを使用
2. `simulation_mode`をTRUEに設定（初期設定済み）
3. `manual_start`をTRUEにしてシーケンス開始
4. 動作状況を各ランプで確認
5. 必要に応じて`manual_stop`で停止
6. `manual_reset`でシステムリセット

### 実機での使用

1. `simulation_mode`をFALSEに設定
2. 実際のI/O点を`ST_ManufacturingSystemIO`に配線
3. 軸設定を実機に合わせて調整
4. 位置パラメータを実機に合わせて設定

## カスタマイズポイント

### 位置パラメータ
- `home_position_x/y/z` - ホーム位置
- `pick_position_x/y/z` - ピック位置
- `place_position_x/y/z` - プレース位置

### モーション制御パラメータ
- `velocity_xy` - XY軸速度
- `velocity_z` - Z軸速度
- `acceleration/deceleration` - 加減速度
- `jerk` - ジャーク

### タイミング設定
- グリッパー動作タイムアウト
- ランプ点滅間隔
- 完了待機時間

## 拡張可能性

このフレームワークベースの実装により、以下の拡張が容易に可能です：

- 追加の軸制御
- 複数のワーク処理
- 品質検査工程の追加
- データロギング機能
- 外部システム連携

## エラー処理

- 各Future内でのエラーID設定
- 自動的なabort()メソッド実行
- エラー状態での適切なランプ表示
- 手動リセット機能

## フレームワーク活用

このシステムは既存のTwinCAT PLCジョブフレームワークの機能を最大限活用しています：

- **FB_Executor**による実行エンジン
- **コンテナ型**による複雑なシーケンス管理
- **ファクトリパターン**による動的オブジェクト生成
- **Future**による非同期処理
- **階層化**による複雑なワークフロー構成

---

*この実装は製造現場での実際の使用例として設計されており、TwinCAT3のST言語とジョブフレームワークの効果的な活用方法を示しています。*